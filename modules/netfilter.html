<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Lunatik API Documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Lunatik</h1>


<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Tables">Tables</a></li>
<li><a href="#Class_netfilter_hook">Class netfilter_hook </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/completion.html">completion</a></li>
  <li><a href="../modules/crypto_shash.html">crypto_shash</a></li>
  <li><a href="../modules/crypto_skcipher.html">crypto_skcipher</a></li>
  <li><a href="../modules/data.html">data</a></li>
  <li><a href="../modules/device.html">device</a></li>
  <li><a href="../modules/fib.html">fib</a></li>
  <li><a href="../modules/fifo.html">fifo</a></li>
  <li><a href="../modules/linux.html">linux</a></li>
  <li><a href="../modules/lunatik.html">lunatik</a></li>
  <li><a href="../modules/lunatik.runner.html">lunatik.runner</a></li>
  <li><a href="../modules/mailbox.html">mailbox</a></li>
  <li><a href="../modules/net.html">net</a></li>
  <li><strong>netfilter</strong></li>
  <li><a href="../modules/notifier.html">notifier</a></li>
  <li><a href="../modules/probe.html">probe</a></li>
  <li><a href="../modules/rcu.html">rcu</a></li>
  <li><a href="../modules/socket.html">socket</a></li>
  <li><a href="../modules/socket.inet.html">socket.inet</a></li>
  <li><a href="../modules/syscall.html">syscall</a></li>
  <li><a href="../modules/syscall.table.html">syscall.table</a></li>
  <li><a href="../modules/thread.html">thread</a></li>
  <li><a href="../modules/xdp.html">xdp</a></li>
  <li><a href="../modules/xtable.html">xtable</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/README.md.html">README</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>netfilter</code></h1>
<p>Low-level Lua interface to the Linux Kernel Netfilter framework.</p>
<p> This header file defines constants used by the C implementation and exposed to Lua.</p>


<h2><a href="#Tables">Tables</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#action">action</a></td>
	<td class="summary">Table of Netfilter hook verdicts (actions).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#arp_hooks">arp_hooks</a></td>
	<td class="summary">Table of Netfilter hooks in the ARP family.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bridge_hooks">bridge_hooks</a></td>
	<td class="summary">Table of Netfilter hooks in the BRIDGE family.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bridge_priority">bridge_priority</a></td>
	<td class="summary">Table of Netfilter hook priorities in the BRIDGE family.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#family">family</a></td>
	<td class="summary">Table of Netfilter protocol families.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#inet_hooks">inet_hooks</a></td>
	<td class="summary">Table of Netfilter hooks in the INET (IPv4/IPv6) family.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#ip_priority">ip_priority</a></td>
	<td class="summary">Table of Netfilter hook priorities in the IP family.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#netdev_hooks">netdev_hooks</a></td>
	<td class="summary">Table of Netfilter hooks in the NETDEV family.</td>
	</tr>
</table>
<h2><a href="#Class_netfilter_hook">Class netfilter_hook </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#netfilter_hook:register">netfilter_hook:register (opts)</a></td>
	<td class="summary">Registers a Netfilter hook.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Tables"></a>Tables</h2>

    <dl class="function">
    <dt>
    <a name = "action"></a>
    <strong>action</strong>
    </dt>
    <dd>
    Table of Netfilter hook verdicts (actions).
 These determine the fate of a packet processed by a hook.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">DROP</span>
            <span class="types"><span class="type">integer</span></span>
         Drop the packet silently.
        </li>
        <li><span class="parameter">ACCEPT</span>
            <span class="types"><span class="type">integer</span></span>
         Let the packet pass.
        </li>
        <li><span class="parameter">STOLEN</span>
            <span class="types"><span class="type">integer</span></span>
         Packet is consumed by the hook; processing stops.
        </li>
        <li><span class="parameter">QUEUE</span>
            <span class="types"><span class="type">integer</span></span>
         Queue the packet to a userspace program.
        </li>
        <li><span class="parameter">REPEAT</span>
            <span class="types"><span class="type">integer</span></span>
         Re-inject the packet into the current hook (use with caution).
        </li>
        <li><span class="parameter">STOP</span>
            <span class="types"><span class="type">integer</span></span>
         Terminate rule traversal in the current chain (iptables specific).
        </li>
        <li><span class="parameter">CONTINUE</span>
            <span class="types"><span class="type">integer</span></span>
         Alias for ACCEPT, primarily for Xtables.
        </li>
        <li><span class="parameter">RETURN</span>
            <span class="types"><span class="type">integer</span></span>
         Return from the current chain to the calling chain (iptables specific).
        </li>
    </ul>





</dd>
    <dt>
    <a name = "arp_hooks"></a>
    <strong>arp_hooks</strong>
    </dt>
    <dd>
    Table of Netfilter hooks in the ARP family.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">IN</span>
            <span class="types"><span class="type">integer</span></span>
         For incoming ARP packets.
        </li>
        <li><span class="parameter">OUT</span>
            <span class="types"><span class="type">integer</span></span>
         For outgoing ARP packets.
        </li>
        <li><span class="parameter">FORWARD</span>
            <span class="types"><span class="type">integer</span></span>
         For forwarded ARP packets (e.g., by an ARP proxy).
        </li>
    </ul>





</dd>
    <dt>
    <a name = "bridge_hooks"></a>
    <strong>bridge_hooks</strong>
    </dt>
    <dd>
    Table of Netfilter hooks in the BRIDGE family.
 These define points for processing layer 2 (Ethernet) bridge traffic.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">PRE_ROUTING</span>
            <span class="types"><span class="type">integer</span></span>
         For packets entering the bridge, before any bridge processing (e.g., ebtables broute chain).
        </li>
        <li><span class="parameter">LOCAL_IN</span>
            <span class="types"><span class="type">integer</span></span>
         For bridged packets destined for the bridge interface itself (if IP processing is enabled on the bridge).
        </li>
        <li><span class="parameter">FORWARD</span>
            <span class="types"><span class="type">integer</span></span>
         For packets being forwarded by the bridge between its ports (e.g., ebtables filter chain).
        </li>
        <li><span class="parameter">LOCAL_OUT</span>
            <span class="types"><span class="type">integer</span></span>
         For packets originating from the bridge interface itself.
        </li>
        <li><span class="parameter">POST_ROUTING</span>
            <span class="types"><span class="type">integer</span></span>
         For packets leaving the bridge, after all bridge processing (e.g., ebtables nat chain).
        </li>
    </ul>





</dd>
    <dt>
    <a name = "bridge_priority"></a>
    <strong>bridge_priority</strong>
    </dt>
    <dd>
    Table of Netfilter hook priorities in the BRIDGE family.
 Hooks with lower priority numbers are called earlier.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">FIRST</span>
            <span class="types"><span class="type">integer</span></span>
         Highest priority for bridge hooks.
        </li>
        <li><span class="parameter">NAT_DST_BRIDGED</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for Destination NAT on bridged-only packets (ebtables <code>dnat</code> chain).
        </li>
        <li><span class="parameter">FILTER_BRIDGED</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for filtering bridged-only packets (ebtables <code>filter</code> chain in FORWARD).
        </li>
        <li><span class="parameter">BRNF</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for bridge netfilter specific operations (interaction between bridge and IP stack).
        </li>
        <li><span class="parameter">NAT_DST_OTHER</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for Destination NAT on packets routed through the bridge (iptables <code>PREROUTING</code> on bridge interface).
        </li>
        <li><span class="parameter">FILTER_OTHER</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for filtering packets routed through the bridge (iptables <code>FORWARD</code> or <code>INPUT</code> on bridge interface).
        </li>
        <li><span class="parameter">NAT_SRC</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for Source NAT on bridged or routed packets (ebtables <code>snat</code> or iptables <code>POSTROUTING</code>).
        </li>
        <li><span class="parameter">LAST</span>
            <span class="types"><span class="type">integer</span></span>
         Lowest priority for bridge hooks.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "family"></a>
    <strong>family</strong>
    </dt>
    <dd>
    Table of Netfilter protocol families.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">UNSPEC</span>
            <span class="types"><span class="type">integer</span></span>
         Unspecified protocol family.
        </li>
        <li><span class="parameter">UNSPEC</span>
            <span class="types"><span class="type">integer</span></span>
         Unspecified protocol family.
        </li>
        <li><span class="parameter">INET</span>
            <span class="types"><span class="type">integer</span></span>
         Internetwork protocol family (covering IPv4/IPv6).
        </li>
        <li><span class="parameter">IPV4</span>
            <span class="types"><span class="type">integer</span></span>
         Internet Protocol version 4.
        </li>
        <li><span class="parameter">IPV6</span>
            <span class="types"><span class="type">integer</span></span>
         Internet Protocol version 6.
        </li>
        <li><span class="parameter">ARP</span>
            <span class="types"><span class="type">integer</span></span>
         Address Resolution Protocol.
        </li>
        <li><span class="parameter">NETDEV</span>
            <span class="types"><span class="type">integer</span></span>
         Network device hooks (ingress/egress).
        </li>
        <li><span class="parameter">BRIDGE</span>
            <span class="types"><span class="type">integer</span></span>
         Ethernet bridging hooks.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "inet_hooks"></a>
    <strong>inet_hooks</strong>
    </dt>
    <dd>
    Table of Netfilter hooks in the INET (IPv4/IPv6) family.
 These define points in the network stack where packet processing can occur.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">PRE_ROUTING</span>
            <span class="types"><span class="type">integer</span></span>
         After packet reception, before routing decision.
        </li>
        <li><span class="parameter">LOCAL_IN</span>
            <span class="types"><span class="type">integer</span></span>
         For packets destined to the local machine, after routing.
        </li>
        <li><span class="parameter">FORWARD</span>
            <span class="types"><span class="type">integer</span></span>
         For packets to be forwarded to another interface, after routing.
        </li>
        <li><span class="parameter">LOCAL_OUT</span>
            <span class="types"><span class="type">integer</span></span>
         For packets generated locally, before sending to an interface.
        </li>
        <li><span class="parameter">POST_ROUTING</span>
            <span class="types"><span class="type">integer</span></span>
         Before packets are sent out, after routing and just before handing to hardware.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "ip_priority"></a>
    <strong>ip_priority</strong>
    </dt>
    <dd>
    Table of Netfilter hook priorities in the IP family.
 Hooks with lower priority numbers are called earlier within the same hook point.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">FIRST</span>
            <span class="types"><span class="type">integer</span></span>
         Highest priority, hook runs first.
        </li>
        <li><span class="parameter">RAW_BEFORE_DEFRAG</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for <code>raw</code> table processing, before packet defragmentation.
        </li>
        <li><span class="parameter">CONNTRACK_DEFRAG</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for connection tracking related to defragmentation.
        </li>
        <li><span class="parameter">RAW</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for <code>raw</code> table processing.
        </li>
        <li><span class="parameter">SELINUX_FIRST</span>
            <span class="types"><span class="type">integer</span></span>
         Early priority for SELinux hooks.
        </li>
        <li><span class="parameter">CONNTRACK</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for main connection tracking.
        </li>
        <li><span class="parameter">MANGLE</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for <code>mangle</code> table processing (packet alteration).
        </li>
        <li><span class="parameter">NAT_DST</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for Destination NAT (<code>nat</code> table, PREROUTING/OUTPUT).
        </li>
        <li><span class="parameter">FILTER</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for <code>filter</code> table processing (packet filtering).
        </li>
        <li><span class="parameter">SECURITY</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for security modules like SELinux.
        </li>
        <li><span class="parameter">NAT_SRC</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for Source NAT (<code>nat</code> table, POSTROUTING/INPUT).
        </li>
        <li><span class="parameter">SELINUX_LAST</span>
            <span class="types"><span class="type">integer</span></span>
         Late priority for SELinux hooks.
        </li>
        <li><span class="parameter">CONNTRACK_HELPER</span>
            <span class="types"><span class="type">integer</span></span>
         Priority for connection tracking helper modules.
        </li>
        <li><span class="parameter">LAST</span>
            <span class="types"><span class="type">integer</span></span>
         Lowest priority, hook runs last.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "netdev_hooks"></a>
    <strong>netdev_hooks</strong>
    </dt>
    <dd>
    Table of Netfilter hooks in the NETDEV family.
 These hooks operate at the network device driver level.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">INGRESS</span>
            <span class="types"><span class="type">integer</span></span>
         For packets as they are received by a network device, very early in the stack.
        </li>
        <li><span class="parameter">EGRESS</span>
            <span class="types"><span class="type">integer</span></span>
         For packets just before they are transmitted by a network device, very late in the stack (Kernel 5.16+).
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header has-description"><a name="Class_netfilter_hook"></a>Class netfilter_hook </h2>

          <div class="section-description">
          Represents a registered Netfilter hook.
 This is a userdata object returned by <code>netfilter.register()</code>. It encapsulates
 the kernel <code>struct nf_hook_ops</code> and associated Lunatik runtime information
 necessary to invoke the Lua callback when a packet matches the hook criteria.
          </div>
    <dl class="function">
    <dt>
    <a name = "netfilter_hook:register"></a>
    <strong>netfilter_hook:register (opts)</strong>
    </dt>
    <dd>
    Registers a Netfilter hook.
 The hook function will be called for packets matching the specified criteria.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">opts</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.4/manual.html#6.6">table</a></span>

<p> A table containing the options for the Netfilter hook.
   It should have the following fields:</p>

<ul>
    <li><code>hook</code> (function): The Lua function to be called for each packet.
     It receives a <code>luadata</code> object representing the packet buffer (<code>skb</code>)
     and should return an integer verdict (e.g., <code>netfilter.action.ACCEPT</code>).</li>
    <li><code>pf</code> (integer): The protocol family (e.g., <code>netfilter.family.INET</code>).</li>
    <li><code>hooknum</code> (integer): The hook number within the protocol family (e.g., <code>netfilter.inet_hooks.LOCAL_OUT</code>).</li>
    <li><code>priority</code> (integer): The hook priority (e.g., <code>netfilter.ip_priority.FILTER</code>).</li>
    <li><code>mark</code> (integer, optional): Packet mark to match. If set, the hook is only called for packets with this mark.</li>
</ul>

        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">userdata</span></span>
        A handle representing the registered hook. This handle can be garbage collected to unregister the hook.
    </ol>




</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/lunarmodules/LDoc">LDoc 1.5.0</a></i>
<i style="float:right;">Last updated 2025-07-08 22:17:28 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
